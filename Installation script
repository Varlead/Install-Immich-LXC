- Récupérer le template de CT - Ubuntu - Dernière version LTS

- Créer une nouvelle CT
  - décocher unproviledged 
  - Disk size = 32 GB32
  - Core 8
  - Memory 4096 / 2048
  - Network DHCP

====> Si pas de console, prendre une version plus vielle de ubuntu

  ------ Dans le shell principal de proxmox, activier nfs pour la CT et l'accélération video
nano /etc/pve/lxc/<ID_du_conteneur>.conf
  ------ Ajouter

lxc.apparmor.profile = unconfined
lxc.cgroup2.devices.allow: c 226:0 rwm
lxc.cgroup2.devices.allow: c 226:128 rwm
lxc.cgroup2.devices.allow: c 29:0 rwm
lxc.mount.entry: /dev/dri dev/dri none bind,optional,create=dir
lxc.mount.entry: /dev/fb0 dev/fb0 none bind,optional,create=file

  ------ montage auto du nfs
sudo apt install -y nfs-common
sudo mkdir -p /mnt/immich_nfs

crontab -e
@reboot sudo mount -t nfs -o vers=4 192.168.3.171:/volume1/photo/MobileBackup /mnt/immich_nfs



===============================================
Installation de Docker
===============================================

 - Mettre à jour le systèm
sudo apt update && sudo apt upgrade -y

  - Installer Prérequis
sudo apt install -y apt-transport-https ca-certificates curl gnupg lsb-release

  - Ajouter la clé GPG de Docker
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg

  -  Ajouter le dépôt Docker
echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null

  - Installer Docker Engine
sudo apt update
sudo apt install -y docker-ce docker-ce-cli containerd.io

  - Vérifier l’installation
docker --version

  - Ajouter l’utilisateur au groupe Docker
sudo usermod -aG docker $USER

  - Installer Docker Compose
sudo apt install -y docker-compose


===============================================
Installation de immich
===============================================
mkdir ./immich-app
cd ./immich-app

  - Get docker-compose.yml file
wget -O docker-compose.yml https://github.com/immich-app/immich/releases/latest/download/docker-compose.yml

  - Get .env file
wget -O .env https://github.com/immich-app/immich/releases/latest/download/example.env

  - Configuration du yml
nano docker-compose.yml

Dans volume, ajouter :
- /mnt/immich_nfs:/mnt/media/mesPhotosTelephone:ro


  - Start the containers
docker compose up -d


